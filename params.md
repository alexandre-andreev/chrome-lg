
# ====================
#GEMINI_MODEL, по умолчанию gemini-2.0-flash

GEMINI_MODEL=gemini-2.5-flash-lite

# GEMINI_TIMEOUT_S - таймаут для обычных запросов к Gemini (чат) в секундах
# По умолчанию: 20 секунд. Увеличьте при медленном соединении или сложных промптах.
GEMINI_TIMEOUT_S=20

# GEMINI_EXPORT_TIMEOUT_S - таймаут для экспорта страниц в Markdown в секундах
# По умолчанию: 40 секунд (больше чем для чата, т.к. экспорт требует больше обработки).
# Увеличьте если получаете таймауты при экспорте больших страниц.
GEMINI_EXPORT_TIMEOUT_S=40

# ==================== ОСНОВНЫЕ РЕЖИМЫ ====================

# STREAMING_ENABLED управляет тем, разрешает ли бэкенд использование стримингового эндпоинта
# (выключено): /chat_stream возвращает ошибку 403, и расширение переключается на использование /chat (один JSON-ответ).
# 1 (включено): /chat_stream возвращает текстовый поток (text/plain) с инкрементными токенами. Для этого также требуется GEMINI_API_KEY; без этого ключа /chat_stream возвращает 403.
# Устанавливайте 0 во время отладки или при нестабильной сети, чтобы избежать зависаний и сохранить простоту поведения.
# Устанавливайте 1 для рабочей среды или когда вам нужны постепенные обновления по токенам и у вас есть действительный GEMINI_API_KEY (и, опционально, EXA_API_KEY).
# Стабильность (0) vs интерактивность (1)

# Стабильность (0) vs интерактивность (1)
STREAMING_ENABLED=1                    # Для Chrome-расширения - стабильность важнее


# ==================== ПАРАМЕТРЫ RAG ====================
# ВКЛЮЧАЕМ RAG - это основа работы!
RAG_ENABLED=1
# Увеличиваем для лучшего покрытия страницы
RAG_TOP_K=8
# RAG_DEBUG=1 - для отладки
RAG_DEBUG=1
# ==================== ПАРАМЕТРЫ ГРАФА ====================
# Размер чанка для веб-контента
LG_CHUNK_SIZE=600                      # Оптимально для фрагментарного веб-контента
LG_CHUNK_OVERLAP=90                    # 15% перекрытия для сохранения контекста

# Автоматически вычисляемые параметры (можно убрать из конфига)
# минимальная общая длина текста для включения разбиения. Если 0, используется 2×LG_CHUNK_SIZE
LG_CHUNK_MIN_TOTAL=0                # 2 × LG_CHUNK_SIZE (вычислять автоматически)

# Количество извлекаемых чанков
LG_CHUNK_NOTES_MAX_CHUNKS=8            # Синхронизируем с RAG_TOP_K
# LG_NOTES_MAX: максимум заметок, которые собираем на шаге chunk_notes (сколько пунктов вообще
# генерируем из текста). по умолчанию 12, чем больше заметок тем богаче ответ
LG_NOTES_MAX=8                        # Баланс между богатством и шумом
# LG_NOTES_SHOW_MAX: максимум заметок, которые включаем в промпт (сколько реально пойдёт в LLM)
LG_NOTES_SHOW_MAX = 10
# Бюджет контекста для промпта
LG_PROMPT_TEXT_CHARS=12000              # Используем возможности Gemini

# ==================== ИНТЕЛЛЕКТУАЛЬНЫЙ ПОИСК ====================

# Когда активировать поиск Exa
LG_SEARCH_MIN_CONTEXT_CHARS=400        # Более чувствительный порог

# Настройки Exa
#сколько сниппетов EXA включать в промпт (по умолчанию 3).увеличение снижает скорость
LG_EXA_TIME_BUDGET_S=4.0               # Для Chrome-расширения важна скорость
# включить мягкие эвристики поиска = 1, отключить = 0
LG_SEARCH_HEURISTICS=1                 # Оставляем умные решения
# LG_SEARCH_RESULTS_MAX - сколько сниппетов EXA включать в промпт
LG_SEARCH_RESULTS_MAX=3                # Баланс: больше ≠ лучше
# LG_SEARCH_SNIPPET_CHARS -длина каждого сниппета (по умолчанию 300). Диапазон 400–600.
LG_SEARCH_SNIPPET_CHARS=500            # Достаточно для информативных сниппетов
# LG_ANSWER_MAX_SENTENCES - это ограничитель длины итогового ответа в предложениях (постобработка).
# 0: отключено (не сокращаем).
# >0: обрезаем финальный ответ до указанного числа предложений.
LG_ANSWER_MAX_SENTENCES=0

# ==================== EXA GET_CONTENTS API ====================

# EXA_HIGHLIGHTS_ENABLED - включить извлечение ключевых фрагментов (highlights)
# Highlights - это наиболее релевантные предложения, выбранные LLM Exa из контента страницы.
# 1 (включено): используются highlights вместо обычных snippet для более точных результатов
# 0 (выключено): используются только базовые текстовые фрагменты
EXA_HIGHLIGHTS_ENABLED=1

# EXA_HIGHLIGHTS_PER_URL - количество highlights для каждого результата поиска
# Диапазон: 1-5. Больше = подробнее контекст, но медленнее и дороже API.
# Рекомендуется: 2-3 для баланса качества и скорости.
EXA_HIGHLIGHTS_PER_URL=2

# EXA_HIGHLIGHTS_NUM_SENTENCES - количество предложений в каждом highlight
# Диапазон: 1-3. Больше = больше контекста вокруг ключевой информации.
# Рекомендуется: 2 для достаточного контекста.
EXA_HIGHLIGHTS_NUM_SENTENCES=2

# EXA_HIGHLIGHTS_QUERY - кастомный запрос для направления выбора highlights
# Пустая строка (по умолчанию): LLM Exa автоматически выбирает релевантные фрагменты.
# Заполненная строка: направляет LLM на конкретные аспекты.
# Примеры: "Ключевые технические характеристики", "Цены и условия", "Отзывы пользователей"
EXA_HIGHLIGHTS_QUERY=

# EXA_SUMMARY_ENABLED - включить генерацию краткого саммари каждой страницы
# 0 (выключено, рекомендуется): не генерировать summaries (экономия API запросов)
# 1 (включено): LLM Exa создает краткое содержание каждой страницы
# ⚠️ ВНИМАНИЕ: Включение summaries увеличивает стоимость API запросов примерно в 2 раза!
EXA_SUMMARY_ENABLED=0

# EXA_SUMMARY_QUERY - кастомный запрос для генерации summary
# Пустая строка: LLM создает общее краткое содержание страницы.
# Заполненная строка: направляет LLM на конкретные аспекты суммаризации.
# Примеры: "Основные выводы и рекомендации", "Преимущества и недостатки", "Ключевые цифры"
# Работает только при EXA_SUMMARY_ENABLED=1
EXA_SUMMARY_QUERY=

# EXA_LIVECRAWL - режим живого краулинга страниц
# Варианты:
#   "never": использовать только кеш Exa (быстро, но данные могут быть устаревшими)
#   "fallback": кеш → краулинг при отсутствии в кеше (рекомендуется, баланс скорости и свежести)
#   "always": всегда краулить страницы заново (медленно, но самые свежие данные)
#   "preferred": краулить → кеш при неудаче (максимальная свежесть с fallback)
EXA_LIVECRAWL=fallback

# EXA_LIVECRAWL_TIMEOUT_MS - таймаут livecrawl в миллисекундах
# Диапазон: 5000-30000 мс (5-30 секунд).
# Больше = больше шансов успешно загрузить медленные сайты, но дольше ожидание.
# Рекомендуется: 10000 (10 сек) для Chrome-расширения.
EXA_LIVECRAWL_TIMEOUT_MS=10000

# EXA_EXTRAS_IMAGE_LINKS - количество URL изображений для извлечения с каждой страницы
# 0 (выключено, рекомендуется): не извлекать изображения
# 1-5: извлечь N изображений с каждой страницы (для будущих визуальных функций)
# Пока не используется в UI, но структура данных готова.
EXA_EXTRAS_IMAGE_LINKS=0

# EXA_INCLUDE_HTML_TAGS - включить HTML-теги в текст для лучшего понимания структуры
# 0 (выключено, рекомендуется): чистый текст без HTML
# 1 (включено): текст с HTML-тегами (<h1>, <p>, <strong> и т.д.)
# Может помочь LLM понять структуру документа (заголовки, списки, акценты).
# ⚠️ ЭКСПЕРИМЕНТАЛЬНО: может увеличить размер промпта и ухудшить читаемость.
EXA_INCLUDE_HTML_TAGS=0

# ==================== ДЕБАГ (ОПЦИОНАЛЬНО) ====================

# Визуализация графа LangGraph
LANGGRAPH_VIZ=save                      # Режим: save|open|1|true|yes (сохранять/открывать граф)
LANGGRAPH_VIZ_FORMAT=mmd                # Формат: mmd|svg|png (mermaid для текста, svg/png для изображений)
LANGGRAPH_VIZ_PATH=./backend_lg/debug/graph.mmd  # Путь относительно корня проекта

# При каждом запуске сервера граф сохраняется в указанный файл
# Формат .mmd поддерживается редакторами (VS Code с расширением Mermaid Preview)
# Для визуализации: https://mermaid.live/
