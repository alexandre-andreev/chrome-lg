# –û—Ç–ª–∞–¥–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

## üêõ –ü—Ä–æ–±–ª–µ–º–∞: –ú–æ–¥–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç —Ç–µ–∫—Å—Ç —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –Ω–æ –º–æ–¥–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç "–∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏", —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

### ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

1. **–†–∞—Å—à–∏—Ä–µ–Ω—ã —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–∞–π—Ç–æ–≤:**
   - Atlassian/Confluence: `.wiki-content`, `[data-testid="page-content"]`
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `.article-content`, `.page-content`
   - –ë–ª–æ–≥–∏: Habr, Medium, WordPress
   - E-commerce: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ product –∫–ª–∞—Å—Å—ã

2. **–î–æ–±–∞–≤–ª–µ–Ω—ã fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã:**
   - –ü–æ–ø—ã—Ç–∫–∞ `<article>` –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ–ª–µ–∫—Ç–æ—Ä –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
   - –û—á–∏—Å—Ç–∫–∞ body –æ—Ç `<script>`, `<style>`, `<nav>`, `<header>`, `<footer>`
   - –ü–æ—Å–ª–µ–¥–Ω–∏–π fallback: –ø–æ–ª–Ω—ã–π `documentElement`

3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º—É—Å–æ—Ä–∞:**
   - –£–¥–∞–ª–µ–Ω–∏–µ DIAG –º–∞—Ä–∫–µ—Ä–æ–≤: `/DIAG[\s\S]*?(?=\n|$)/g`
   - –°—Ö–ª–æ–ø—ã–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —Å—Ç—Ä–æ–∫
   - Trim –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è whitespace

4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:**
   - `content.js`: –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
   - `main.py`: –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:

### 1. –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (DevTools ‚Üí Console):

```javascript
// –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ–±–ª–µ–º–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
// –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Console
// –í—ã —É–≤–∏–¥–∏—Ç–µ –ª–æ–≥–∏ Chrome-bot:

[Chrome-bot] Main content selector matched: article-content
[Chrome-bot] Final text length: 8543
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ `Final text length` > 500 chars ‚Üí —Ö–æ—Ä–æ—à–æ
- ‚ö†Ô∏è `Final text length` < 200 chars ‚Üí –ø—Ä–æ–±–ª–µ–º–∞
- ‚ö†Ô∏è `WARNING: Very short text` ‚Üí –ø–ª–æ—Ö–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ

### 2. –í –ª–æ–≥–∞—Ö –±—ç–∫–µ–Ω–¥–∞ (—Ç–µ—Ä–º–∏–Ω–∞–ª):

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥ –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏:
cd backend_lg
source .venv/bin/activate
uvicorn app.main:app --host 0.0.0.0 --port 8010

# –ü–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞ —É–≤–∏–¥–∏—Ç–µ:
INFO: Chat request: message='—á—Ç–æ —Ç–∞–∫–æ–µ –ø–∞–∫–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤' url='https://...' text_len=8543
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ `text_len > 500` ‚Üí —Ö–æ—Ä–æ—à–æ
- ‚ö†Ô∏è `WARNING: Page text contains DIAG markers` ‚Üí –º—É—Å–æ—Ä –≤ —Ç–µ–∫—Å—Ç–µ
- ‚ö†Ô∏è `WARNING: Short page text` ‚Üí –ø–ª–æ—Ö–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ

---

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º:

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "DIAG" –º–∞—Ä–∫–µ—Ä—ã –≤ —Ç–µ–∫—Å—Ç–µ

**–ü—Ä–∏—á–∏–Ω–∞:** –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–∫–∏

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ `content.js`:
```javascript
.replace(/DIAG[\s\S]*?(?=\n|$)/g, '') // Remove DIAG lines
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ö–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç (< 200 chars)

**–ü—Ä–∏—á–∏–Ω–∞:** –°–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–µ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Å–∞–π—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Elements
2. –ù–∞–π–¥–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –µ–≥–æ –∫–ª–∞—Å—Å/id (–Ω–∞–ø—Ä–∏–º–µ—Ä: `.main-article`)
4. –î–æ–±–∞–≤—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä –≤ `content.js` (—Å—Ç—Ä–æ–∫–∞ 109-120):

```javascript
let mainEl = document.querySelector(
    'main,[role="main"],article,[role="article"],' +
    // ... existing selectors ...
    '.main-article,.your-custom-class' // ‚Üê –î–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞
);
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç (SPA)

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –£–∂–µ –µ—Å—Ç—å `MutationObserver` (—Å—Ç—Ä–æ–∫–∞ 254):
```javascript
const mainContentObserver = new MutationObserver((mutations, observer) => {
    if (document.querySelector('main,[role="main"],article,...')) {
        setTimeout(sendContext, 300);
        observer.disconnect();
    }
});
```

–ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:
1. –£–≤–µ–ª–∏—á—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É: `setTimeout(sendContext, 1000)` (—Å—Ç—Ä–æ–∫–∞ 250)
2. –î–æ–±–∞–≤—å—Ç–µ –≤—Ç–æ—Ä–æ–π —Ç–∞–π–º–µ—Ä: `setTimeout(sendContext, 3000)` (—Å—Ç—Ä–æ–∫–∞ 257)

---

## üìã –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–∞–π—Ç–∞—Ö:

### Atlassian (DevOps —Å—Ç—Ä–∞–Ω–∏—Ü–∞):

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://www.atlassian.com/ru/devops/devops-tools
2. –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ ‚Üí –æ–∂–∏–¥–∞–µ–º:
   ```
   [Chrome-bot] Main content selector matched: ...
   [Chrome-bot] Final text length: 5000+ chars
   ```
3. –õ–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞ ‚Üí –æ–∂–∏–¥–∞–µ–º:
   ```
   INFO: Chat request: text_len=5000+
   ```

### Habr:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±—É—é —Å—Ç–∞—Ç—å—é –Ω–∞ habr.com
2. –°–µ–ª–µ–∫—Ç–æ—Ä—ã: `.article__content`, `.tm-article-body`
3. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: text_len > 3000

### Wikipedia:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±—É—é —Å—Ç–∞—Ç—å—é
2. –°–µ–ª–µ–∫—Ç–æ—Ä: `article` –∏–ª–∏ `[role="article"]`
3. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: text_len > 5000

---

## üö® –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –º–µ—Ä—ã:

### –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:

1. **–í—Ä–µ–º–µ–Ω–Ω—ã–π —Ö–∞–∫ - –≤—Ä—É—á–Ω—É—é –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç:**
   ```javascript
   // –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
   const text = document.querySelector('main').innerText;
   console.log('Extracted:', text.length, 'chars');
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å:**
   - `chrome://extensions`
   - –ù–∞–π–¥–∏—Ç–µ Chrome-bot
   - –ö–ª–∏–∫–Ω–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å" (–∫–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
   - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É

3. **–û—Ç–∫—Ä–æ–π—Ç–µ issue —Å –ø—Ä–∏–º–µ—Ä–æ–º:**
   - URL –ø—Ä–æ–±–ª–µ–º–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   - –°–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
   - –õ–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞
   - –ö–ª–∞—Å—Å/id –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–∏–∑ DevTools ‚Üí Elements)

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

- [ ] –û—Ç–∫—Ä—ã–ª DevTools ‚Üí Console
- [ ] –í–∏–∂—É –ª–æ–≥–∏ `[Chrome-bot]`
- [ ] `Final text length` > 500?
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞
- [ ] `text_len` –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–æ–π?
- [ ] –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ DIAG –∏–ª–∏ short text?
- [ ] –ü–æ–ø—Ä–æ–±–æ–≤–∞–ª –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
- [ ] –û–±–Ω–æ–≤–∏–ª —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤ `chrome://extensions`

–ï—Å–ª–∏ –≤—Å–µ —á–µ–∫–±–æ–∫—Å—ã ‚úÖ –Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å ‚Üí —Å–æ–æ–±—â–∏—Ç–µ —Å –¥–µ—Ç–∞–ª—è–º–∏!

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞:

–ü—Ä–∏ —Å–æ–æ–±—â–µ–Ω–∏–∏ –æ –ø—Ä–æ–±–ª–µ–º–µ —É–∫–∞–∂–∏—Ç–µ:
1. **URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã:** `https://...`
2. **–õ–æ–≥–∏ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:** —Å–∫—Ä–∏–Ω—à–æ—Ç –∏–ª–∏ —Ç–µ–∫—Å—Ç
3. **–õ–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞:** –≤—ã–≤–æ–¥ –∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
4. **–°–µ–ª–µ–∫—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞:** –∏–∑ DevTools ‚Üí Elements
5. **–¢–µ–∫—Å—Ç –∫–æ—Ç–æ—Ä—ã–π –≤–∏–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:** —Ü–∏—Ç–∞—Ç–∞

–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É! üöÄ




