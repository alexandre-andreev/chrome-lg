# Langfuse Metrics Visualization Guide

## üìä –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫ Langfuse –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ Chrome-bot.

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 1. `analyze_langfuse_metrics.py` - –ê–Ω–∞–ª–∏–∑ –º–µ—Ç—Ä–∏–∫

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç traces –∏–∑ Langfuse
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç latency, token usage, —á–∞—Å—Ç–æ—Ç—É –æ–ø–µ—Ä–∞—Ü–∏–π
- –î–∞—ë—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤ JSON –∏ TXT

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ (–≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å)
python analyze_langfuse_metrics.py

# –° —ç–∫—Å–ø–æ—Ä—Ç–æ–º –≤ —Ñ–∞–π–ª—ã
python analyze_langfuse_metrics.py --export-json --export-txt

# –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ traces (max 100)
python analyze_langfuse_metrics.py --limit 50 --export-json
```

**–í—ã—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `langfuse_report.txt` - —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
- `langfuse_metrics.json` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

---

### 2. `visualize_langfuse_metrics.py` - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –°–æ–∑–¥–∞—ë—Ç –≥—Ä–∞—Ñ–∏–∫–∏ –∏–∑ JSON –º–µ—Ç—Ä–∏–∫
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π HTML dashboard
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç PNG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –ë–∞–∑–æ–≤–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç langfuse_metrics.json)
python visualize_langfuse_metrics.py

# –£–∫–∞–∑–∞—Ç—å –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
python visualize_langfuse_metrics.py my_metrics.json --output-dir my_charts
```

**–°–æ–∑–¥–∞–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã:**

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `operation_frequency.png` | –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —á–∞—Å—Ç–æ—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π |
| `latency_comparison.png` | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ latency (avg vs p95) |
| `token_usage.png` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (input/output/total) |
| `trace_timeline.png` | Timeline —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–æ–∫ –ø–æ —Ç–∏–ø–∞–º |
| `metrics_dashboard.html` | **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π dashboard** (–æ—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ) |
| `summary.txt` | –¢–µ–∫—Å—Ç–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ |

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –°–æ–±–µ—Ä–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ
```bash
# –°–¥–µ–ª–∞–π—Ç–µ 20-50 –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–∞–π—Ç–∞—Ö
# Langfuse –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç traces
```

### –®–∞–≥ 2: –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –º–µ—Ç—Ä–∏–∫–∏
```bash
python analyze_langfuse_metrics.py --export-json --export-txt
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞–π—Ç–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
```bash
python visualize_langfuse_metrics.py
```

### –®–∞–≥ 4: –ò–∑—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π dashboard
firefox charts/metrics_dashboard.html  # –∏–ª–∏ chromium, google-chrome

# –ò–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç–∞—Ç–∏—á–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏
eog charts/*.png

# –ò–ª–∏ –ø—Ä–æ—á—Ç–∏—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—É—é —Å–≤–æ–¥–∫—É
cat charts/summary.txt
```

---

## üìà –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### Operation Frequency (–ß–∞—Å—Ç–æ—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–π)

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü—Ä–∏–º–µ—Ä—ã:**
- `gemini_generate` 70% ‚Üí LLM –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ‚úÖ
- `rag_retrieve` + `rag_upsert` < 20% ‚Üí RAG –Ω–µ–¥–æ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ‚ö†Ô∏è
- `exa_search` > 30% ‚Üí –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤–Ω–µ—à–Ω–∏—Ö –ø–æ–∏—Å–∫–æ–≤, —É–≤–µ–ª–∏—á—å—Ç–µ RAG üí°

### Latency Analysis (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü–æ—Ä–æ–≥–∏:**
- `gemini_generate` > 5s ‚Üí —É–º–µ–Ω—å—à–∏—Ç–µ `LG_PROMPT_TEXT_CHARS`
- `rag_retrieve` > 1s ‚Üí —É–º–µ–Ω—å—à–∏—Ç–µ `RAG_TOP_K` –∏–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∏–Ω–¥–µ–∫—Å
- `exa_search` > 3s ‚Üí —É–º–µ–Ω—å—à–∏—Ç–µ `EXA_NUM_RESULTS`

### Token Usage (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** –°—Ä–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- `avg_input > 8000` ‚Üí –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –ø—Ä–æ–º–ø—Ç, —É–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- `avg_output > 1000` ‚Üí –û—Ç–≤–µ—Ç—ã —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–µ, –¥–æ–±–∞–≤—å—Ç–µ `LG_ANSWER_MAX_SENTENCES`
- `cost > $0.001/request` ‚Üí –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –±–æ–ª–µ–µ –¥–µ—à—ë–≤—É—é –º–æ–¥–µ–ª—å

---

## üîÑ –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ü—Ä–æ—Ü–µ—Å—Å A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **Baseline (–±–∞–∑–æ–≤–∞—è –ª–∏–Ω–∏—è)**
   ```bash
   # –¢–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   python analyze_langfuse_metrics.py --export-json
   cp langfuse_metrics.json baseline_metrics.json
   python visualize_langfuse_metrics.py baseline_metrics.json --output-dir baseline
   ```

2. **–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç (–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)**
   ```bash
   # –ò–∑–º–µ–Ω–∏—Ç–µ params.override.json
   # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —á–µ—Ä–µ–∑ /config –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
   
   # –°–¥–µ–ª–∞–π—Ç–µ 20-30 –∑–∞–ø—Ä–æ—Å–æ–≤
   
   # –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
   python analyze_langfuse_metrics.py --export-json
   cp langfuse_metrics.json experiment_metrics.json
   python visualize_langfuse_metrics.py experiment_metrics.json --output-dir experiment
   ```

3. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ**
   ```bash
   # –°—Ä–∞–≤–Ω–∏—Ç–µ –≤–∏–∑—É–∞–ª—å–Ω–æ
   diff baseline/summary.txt experiment/summary.txt
   
   # –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
   python compare_metrics.py baseline_metrics.json experiment_metrics.json
   ```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä 1: –°–Ω–∏–∂–µ–Ω–∏–µ latency

**–ü—Ä–æ–±–ª–µ–º–∞:** `gemini_generate` avg = 8s

**–î–µ–π—Å—Ç–≤–∏—è:**
```json
// params.override.json
{
  "LG_PROMPT_TEXT_CHARS": "12000" ‚Üí "6000",
  "LG_NOTES_SHOW_MAX": "10" ‚Üí "6",
  "GEMINI_MODEL": "gemini-2.0-flash" ‚Üí "gemini-2.5-flash-lite"
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** latency ‚Üì 40-50%

### –ü—Ä–∏–º–µ—Ä 2: –°–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** cost = $0.002/request

**–î–µ–π—Å—Ç–≤–∏—è:**
```json
{
  "LG_PROMPT_TEXT_CHARS": "12000" ‚Üí "8000",
  "LG_ANSWER_MAX_SENTENCES": "0" ‚Üí "7",
  "RAG_TOP_K": "8" ‚Üí "12"  // –ë–æ–ª—å—à–µ RAG, –º–µ–Ω—å—à–µ raw text
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** cost ‚Üì 30-40%

### –ü—Ä–∏–º–µ—Ä 3: –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç–≤–µ—Ç—ã –Ω–µ–ø–æ–ª–Ω—ã–µ –∏–ª–∏ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ

**–î–µ–π—Å—Ç–≤–∏—è:**
```json
{
  "RAG_TOP_K": "8" ‚Üí "15",
  "LG_CHUNK_SIZE": "900" ‚Üí "1200",
  "LG_NOTES_MAX": "6" ‚Üí "12"
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–∞—á–µ—Å—Ç–≤–æ ‚Üë, –Ω–æ latency –∏ cost —Ç–æ–∂–µ ‚Üë

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ë—ã—Å—Ç—Ä–∞—è (Low Latency)
```json
{
  "LG_PROMPT_TEXT_CHARS": "6000",
  "LG_NOTES_SHOW_MAX": "5",
  "RAG_TOP_K": "5",
  "GEMINI_MODEL": "gemini-2.5-flash-lite",
  "LG_ANSWER_MAX_SENTENCES": "5"
}
```

### –≠–∫–æ–Ω–æ–º–Ω–∞—è (Low Cost)
```json
{
  "LG_PROMPT_TEXT_CHARS": "8000",
  "RAG_TOP_K": "12",
  "RAG_ENABLED": "1",
  "LG_SEARCH_MIN_CONTEXT_CHARS": "20000",
  "LG_ANSWER_MAX_SENTENCES": "7"
}
```

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è (High Quality)
```json
{
  "LG_PROMPT_TEXT_CHARS": "15000",
  "LG_NOTES_SHOW_MAX": "15",
  "RAG_TOP_K": "15",
  "LG_CHUNK_SIZE": "1200",
  "GEMINI_MODEL": "gemini-2.0-flash"
}
```

### –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (Recommended)
```json
{
  "LG_PROMPT_TEXT_CHARS": "12000",
  "LG_NOTES_SHOW_MAX": "10",
  "RAG_TOP_K": "10",
  "RAG_ENABLED": "1",
  "GEMINI_MODEL": "gemini-2.5-flash-lite",
  "LG_ANSWER_MAX_SENTENCES": "0"
}
```

---

## üîç Troubleshooting

**–ü—Ä–æ–±–ª–µ–º–∞:** "No latency data available"
- **–ü—Ä–∏—á–∏–Ω–∞:** Langfuse 2.x –Ω–µ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç latency —á–µ—Ä–µ–∑ API
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Langfuse UI (Analytics) –¥–ª—è latency –º–µ—Ç—Ä–∏–∫

**–ü—Ä–æ–±–ª–µ–º–∞:** "No token usage data available"
- **–ü—Ä–∏—á–∏–Ω–∞:** –¢–æ–∫–µ–Ω—ã –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Langfuse UI ‚Üí Generations –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –ì—Ä–∞—Ñ–∏–∫–∏ –ø—É—Å—Ç—ã–µ
- **–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö (< 5 traces)
- **–†–µ—à–µ–Ω–∏–µ:** –°–¥–µ–ª–∞–π—Ç–µ –±–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **Langfuse Dashboard:** https://cloud.langfuse.com
- **API Documentation:** https://api.reference.langfuse.com
- **Gemini Pricing:** https://ai.google.dev/pricing
- **Optimization Guide:** –°–º. `LANGFUSE_SETUP.md`

---

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π

–í—ã –º–æ–∂–µ—Ç–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `visualize_langfuse_metrics.py` –¥–ª—è:
- –î–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤
- –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º—ã
- –≠–∫—Å–ø–æ—Ä—Ç–∞ –≤ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã (PDF, SVG)
- –°–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–π (GIF) –¥–ª—è —Ç—Ä–µ–Ω–¥–æ–≤

–ü—Ä–∏–º–µ—Ä—ã –¥–æ—Ä–∞–±–æ—Ç–æ–∫ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∫–æ–¥–∞.

---

**–ü—Ä–∏—è—Ç–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏!** üöÄ

